\documentclass[tikz,crop]{standalone}
\input{preamble/tikz_standalone.tex}
\input{preamble/tikz_colors.tex}
\input{preamble/tikz_common.tex}
\input{preamble/tikz_style.tex}
\input{../preamble/abbreviations.tex}

\begin{document}
% zero_warp = 5 * 2 * pi * x
% one_warp = 5 * 2 * pi * x ** 2
% generator = (.75 * (1. - tanh(x / 15.)) + .25) * sin(x)
% zero_post_warp = tanh(4 * x)
% one_post_warp = x

\begin{tikzpicture}
    \def\datapath{\figurepath/data/dampened_sine}
    \begin{axis}[
            wind decomposition,
            xlabel=$\rv{X}$, ylabel=$\rv{a}$,
            xmin=0, xmax=1,
            xticklabels={,0, , 1},
            xticklabel pos=top,
            ymin=-0.1, ymax=1.1,
            yticklabels={,0, , 1},
            ytick pos=left,
            name=first_alignment,
        ]

        \addplot[first, weak mean, domain=0:1, samples=3]{x};
    \end{axis}

    \begin{axis}[
            at={(75pt, 0)},
            wind decomposition,
            xlabel=$\rv{X}$, ylabel=$\rv{a}$,
            xmin=0, xmax=1,
            xticklabels={,0, , 1},
            xticklabel pos=top,
            ymin=-0.1, ymax=1.1,
            yticklabels={,0, , 1},
            ytick pos=right,
            name=second_alignment,
        ]

        \addplot[second, weak mean, domain=0:1, samples=50]{x^2};
    \end{axis}

    \begin{axis}[
            at={(37.5pt, -45pt)},
            wind decomposition,
            xlabel=$\rv{a}$, ylabel=$\rv{f}$,
            xticklabels={,0, , 1},
            xticklabel pos=top,
            ymin=-1.1, ymax=1.1,
            yticklabels={,-1, , 1},
            ytick pos=left,
            name=third,
        ]

        \addplot[third, weak mean, domain=0:1, samples=100]{
            (.75 * (1. - tanh(x * 10 * pi / 15)) + .25) * sin(deg(x * 10 * pi))
        };
    \end{axis}

    \begin{axis}[
            at={(0pt, -90pt)},
            wind decomposition,
            xlabel=$\rv{f}$, ylabel=$\rv{g_1}$,
            xticklabels={,-1, , 1},
            xticklabel pos=top,
            yticklabels={,-1, , 1},
            ytick pos=left,
            name=first_warp,
        ]

        \addplot[first, weak mean, domain=-1:1, samples=50]{tanh(4 * x)};
    \end{axis}

    \begin{axis}[
            at={(75pt, -90pt)},
            wind decomposition,
            xlabel=$\rv{f}$, ylabel=$\rv{g_2}$,
            xticklabels={,-1, , 1},
            xticklabel pos=top,
            yticklabels={,-1, , 1},
            ytick pos=right,
            name=second_warp,
        ]

        \addplot[second, weak mean, domain=-1:1, samples=3]{x};
    \end{axis}

    \tikzstyle{connector} = [
    shorten <= 5pt, shorten >= 10pt,
    arrows={-latex}, line width=1.5pt,
    ]
    \draw[connector, first] (first_alignment.300) -- (third.100);
    \draw[connector, second] (second_alignment.240) -- (third.80);
    \draw[connector, first] (third.240) -- (first_warp.80);
    \draw[connector, second] (third.300) -- (second_warp.100);

    \begin{axis}[
            at={(0pt, -125pt)},
            wind decomposition,
            xlabel=$\rv{X}$, ylabel=$\rv{y_1}$,
            xtick={0, 0.5, 1},
            xticklabels={0, , 1},
            ymin=-1.1, ymax=1.1,
            ytick={-1, 0, 1},
            yticklabels={-1, , 1},
        ]

        \addplot[
            true function, sStoneDark
        ] table[
                ignore chars={\#}, col sep=space,
                x=X, y=Y
            ] {\datapath/sine_latent_first.dat};

        \addplot[
            tiny data, first
        ] table[
                ignore chars={\#}, col sep=space,
                x=X, y=Y
            ] {\datapath/sine_train_first.dat};
    \end{axis}

    \begin{axis}[
            at={(75pt, -125pt)},
            wind decomposition,
            xlabel=$\rv{X}$, ylabel=$\rv{y_2}$,
            xtick={0, 0.5, 1},
            xticklabels={0, , 1},
            ymin=-1.1, ymax=1.1,
            ytick={-1, 0, 1},
            yticklabels={-1, , 1},
            ytick pos=right,
        ]

        \addplot[
            true function, sStoneDark
        ] table[
                ignore chars={\#}, col sep=space,
                x=X, y=Y
            ] {\datapath/sine_latent_second.dat};

        \addplot[
            tiny data, second
        ] table[
                ignore chars={\#}, col sep=space,
                x=X, y=Y
            ] {\datapath/sine_train_second.dat};
    \end{axis}
\end{tikzpicture}
\end{document}
